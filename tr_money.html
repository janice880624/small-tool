<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>鐘點費補發組合試算工具</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { opacity: 1; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen p-4 md:p-8 text-slate-900">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="bg-white rounded-2xl shadow-sm p-6 mb-6 border border-slate-200">
            <div class="flex items-center gap-3 mb-2">
                <div class="p-2 bg-blue-100 rounded-lg text-blue-600">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="8" x2="16" y1="10" y2="10"/><line x1="8" x2="16" y1="14" y2="14"/><line x1="8" x2="16" y1="18" y2="18"/></svg>
                </div>
                <h1 class="text-2xl font-bold text-slate-800">鐘點費補發組合試算工具</h1>
            </div>
            <p class="text-slate-500 text-sm">手動組合 A 方案 ($1,600) 與 B 方案 ($1,300) 次數，對齊 12 月欠款</p>
        </div>

        <!-- Info Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div class="bg-blue-50 border border-blue-100 p-4 rounded-xl flex justify-between items-center shadow-sm">
                <div>
                    <p class="text-blue-700 font-bold">方案 A (2小時版)</p>
                    <p class="text-xs text-blue-600">領 4000 扣除勞務 2400</p>
                </div>
                <div class="text-right">
                    <span class="text-xl font-black text-blue-700">+$1,600</span>
                    <p class="text-[10px] text-blue-500 uppercase">每次補額</p>
                </div>
            </div>
            <div class="bg-emerald-50 border border-emerald-100 p-4 rounded-xl flex justify-between items-center shadow-sm">
                <div>
                    <p class="text-emerald-700 font-bold">方案 B (1小時版)</p>
                    <p class="text-xs text-emerald-600">領 2500 扣除勞務 1200</p>
                </div>
                <div class="text-right">
                    <span class="text-xl font-black text-emerald-700">+$1,300</span>
                    <p class="text-[10px] text-emerald-500 uppercase">每次補額</p>
                </div>
            </div>
        </div>

        <!-- Main Table Container -->
        <div class="bg-white rounded-2xl shadow-sm overflow-hidden border border-slate-200">
            <div class="p-4 bg-slate-50 border-b border-slate-200 flex justify-between items-center">
                <h2 class="font-semibold text-slate-700">對帳清單</h2>
                <button onclick="addTeacher()" class="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all shadow-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" x2="12" y1="5" y2="19"/><line x1="5" x2="19" y1="12" y2="12"/></svg>
                    新增老師
                </button>
            </div>

            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse min-w-[800px]">
                    <thead>
                        <tr class="bg-slate-50/50 text-slate-400 text-[11px] uppercase tracking-wider">
                            <th class="p-4 font-bold border-b">老師姓名</th>
                            <th class="p-4 font-bold border-b">12月欠發時數</th>
                            <th class="p-4 font-bold bg-blue-50/30 text-blue-600 border-b">方案 A 次數</th>
                            <th class="p-4 font-bold bg-emerald-50/30 text-emerald-600 border-b">方案 B 次數</th>
                            <th class="p-4 font-bold border-b">試算結果 (欠款 vs 補發)</th>
                            <th class="p-4 font-bold border-b">結餘狀態</th>
                            <th class="p-4 font-bold text-center border-b">操作</th>
                        </tr>
                    </thead>
                    <tbody id="teacherBody" class="divide-y divide-slate-100">
                        <!-- 動態插入內容 -->
                    </tbody>
                </table>
            </div>
            <div id="emptyState" class="hidden p-12 text-center text-slate-400 italic">
                目前沒有資料，請點擊「新增老師」開始計算。
            </div>
        </div>

        <!-- Logic Footer -->
        <div class="mt-8 bg-slate-800 rounded-2xl p-6 text-slate-300 shadow-xl">
            <h3 class="text-white font-bold mb-4 flex items-center gap-2 text-lg">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="16" y2="12"/><line x1="12" x2="12.01" y1="8" y2="8"/></svg>
                對帳邏輯與報帳公式
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="space-y-2">
                    <p class="text-sm font-bold text-white border-b border-slate-700 pb-1">1. 欠款基準</p>
                    <p class="text-xs">12 月欠發時數 × $1,200 (原本時薪)</p>
                    <p class="text-[10px] italic text-slate-500">這是我們要透過後續領據「補還」給老師的目標額度。</p>
                </div>
                <div class="space-y-2">
                    <p class="text-sm font-bold text-white border-b border-slate-700 pb-1">2. 補償差額來源</p>
                    <p class="text-xs">A方案：$4,000 - ($1,200 × 2h) = <span class="text-blue-400 font-bold">$1,600</span></p>
                    <p class="text-xs">B方案：$2,500 - ($1,200 × 1h) = <span class="text-emerald-400 font-bold">$1,300</span></p>
                </div>
                <div class="space-y-2">
                    <p class="text-sm font-bold text-white border-b border-slate-700 pb-1">3. 目標狀態</p>
                    <p class="text-xs">透過手動輸入次數，使補發總額接近欠款額。</p>
                    <p class="text-xs text-amber-400 italic">若結果為正值，表示領據總額已足夠覆蓋欠款。</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let teachers = [
            { id: Date.now(), name: '老師 A', unpaidHours: 10, countA: 5, countB: 0 },
            { id: Date.now() + 1, name: '老師 B', unpaidHours: 8, countA: 0, countB: 8 }
        ];

        const HOURLY_RATE = 1200;
        const SURPLUS_A = 1600;
        const SURPLUS_B = 1300;

        function render() {
            const body = document.getElementById('teacherBody');
            const emptyState = document.getElementById('emptyState');
            
            if (teachers.length === 0) {
                emptyState.classList.remove('hidden');
                body.innerHTML = '';
                return;
            }
            emptyState.classList.add('hidden');

            body.innerHTML = teachers.map((t, index) => {
                const debt = t.unpaidHours * HOURLY_RATE;
                const compensation = (t.countA * SURPLUS_A) + (t.countB * SURPLUS_B);
                const diff = compensation - debt;

                let statusHtml = '';
                if (diff === 0 && t.unpaidHours > 0) {
                    statusHtml = `<span class="text-emerald-600 text-xs font-bold flex items-center gap-1">已平帳</span>`;
                } else if (diff > 0) {
                    statusHtml = `<div class="flex flex-col"><span class="text-amber-600 text-xs font-bold">多補了 $${diff.toLocaleString()}</span><span class="text-[9px] text-amber-500">領據金額過多</span></div>`;
                } else if (diff < 0) {
                    statusHtml = `<div class="flex flex-col"><span class="text-red-500 text-xs font-bold">尚欠 $${Math.abs(diff).toLocaleString()}</span><span class="text-[9px] text-red-400">還需要補簽</span></div>`;
                } else {
                    statusHtml = `<span class="text-slate-300 text-xs">尚未輸入</span>`;
                }

                return `
                    <tr class="hover:bg-slate-50/50 transition-colors">
                        <td class="p-4">
                            <input type="text" value="${t.name}" onchange="updateTeacher(${t.id}, 'name', this.value)" 
                                class="bg-transparent border-b border-dashed border-slate-300 focus:border-blue-500 outline-none font-bold text-slate-700 w-full p-1">
                        </td>
                        <td class="p-4">
                            <div class="flex items-center gap-2 bg-slate-100 rounded-lg p-1 w-fit">
                                <input type="number" step="0.5" value="${t.unpaidHours}" onchange="updateTeacher(${t.id}, 'unpaidHours', parseFloat(this.value) || 0)" 
                                    class="w-12 bg-transparent text-center font-bold outline-none">
                                <span class="text-[10px] text-slate-400 pr-2">hr</span>
                            </div>
                        </td>
                        <td class="p-4 bg-blue-50/10">
                            <div class="flex items-center gap-2">
                                <input type="number" value="${t.countA}" onchange="updateTeacher(${t.id}, 'countA', parseInt(this.value) || 0)" 
                                    class="w-16 p-2 border border-blue-200 rounded-lg outline-none focus:ring-2 focus:ring-blue-500/20 text-center font-bold text-blue-700">
                                <span class="text-[10px] text-blue-400">次</span>
                            </div>
                        </td>
                        <td class="p-4 bg-emerald-50/10">
                            <div class="flex items-center gap-2">
                                <input type="number" value="${t.countB}" onchange="updateTeacher(${t.id}, 'countB', parseInt(this.value) || 0)" 
                                    class="w-16 p-2 border border-emerald-200 rounded-lg outline-none focus:ring-2 focus:ring-emerald-500/20 text-center font-bold text-emerald-700">
                                <span class="text-[10px] text-emerald-400">次</span>
                            </div>
                        </td>
                        <td class="p-4">
                            <div class="flex items-center gap-3">
                                <div class="text-right">
                                    <p class="text-[10px] text-slate-400 uppercase">欠款</p>
                                    <p class="text-xs font-bold text-slate-600">$${debt.toLocaleString()}</p>
                                </div>
                                <svg class="text-slate-300" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" x2="19" y1="12" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
                                <div>
                                    <p class="text-[10px] text-slate-400 uppercase">補發</p>
                                    <p class="text-xs font-bold text-indigo-600">$${compensation.toLocaleString()}</p>
                                </div>
                            </div>
                        </td>
                        <td class="p-4">
                            ${statusHtml}
                        </td>
                        <td class="p-4 text-center">
                            <button onclick="removeTeacher(${t.id})" class="text-slate-300 hover:text-red-500 transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function addTeacher() {
            teachers.push({
                id: Date.now(),
                name: '新老師',
                unpaidHours: 0,
                countA: 0,
                countB: 0
            });
            render();
        }

        function removeTeacher(id) {
            teachers = teachers.filter(t => t.id !== id);
            render();
        }

        function updateTeacher(id, field, value) {
            const index = teachers.findIndex(t => t.id === id);
            if (index !== -1) {
                teachers[index][field] = value;
                render();
            }
        }

        // 初始渲染
        window.onload = render;
    </script>
</body>
</html>
