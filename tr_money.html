import React, { useState } from 'react';
import { Plus, Trash2, Calculator, Info, AlertCircle, CheckCircle2, ArrowRight } from 'lucide-react';

const App = () => {
  const [teachers, setTeachers] = useState([
    { id: 1, name: '老師 A', unpaidHours: 10, countA: 5, countB: 0 },
    { id: 2, name: '老師 B', unpaidHours: 8, countA: 0, countB: 8 }
  ]);

  const HOURLY_RATE = 1200; // 原本鐘點費基準

  // 方案定義
  const PLAN_A = { surplus: 1600, label: '2hr/$4000' };
  const PLAN_B = { surplus: 1300, label: '1hr/$2500' };

  const addTeacher = () => {
    const newId = teachers.length > 0 ? Math.max(...teachers.map(t => t.id)) + 1 : 1;
    setTeachers([...teachers, { id: newId, name: `新老師`, unpaidHours: 0, countA: 0, countB: 0 }]);
  };

  const removeTeacher = (id) => {
    setTeachers(teachers.filter(t => t.id !== id));
  };

  const updateTeacher = (id, field, value) => {
    setTeachers(teachers.map(t => (t.id === id ? { ...t, [field]: value } : t)));
  };

  const calculateTotal = (teacher) => {
    const debt = teacher.unpaidHours * HOURLY_RATE;
    const compensation = (teacher.countA * PLAN_A.surplus) + (teacher.countB * PLAN_B.surplus);
    const diff = compensation - debt;
    return { debt, compensation, diff };
  };

  return (
    <div className="min-h-screen bg-slate-50 p-4 md:p-8 font-sans text-slate-900">
      <div className="max-w-6xl mx-auto">
        {/* Header */}
        <div className="bg-white rounded-2xl shadow-sm p-6 mb-6 border border-slate-200">
          <div className="flex items-center gap-3 mb-2">
            <div className="p-2 bg-blue-100 rounded-lg text-blue-600">
              <Calculator size={24} />
            </div>
            <h1 className="text-2xl font-bold text-slate-800">鐘點費補發組合試算工具</h1>
          </div>
          <p className="text-slate-500">自訂 A 方案與 B 方案次數，精確對帳 12 月欠款</p>
        </div>

        {/* Info Cards */}
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
          <div className="bg-blue-50 border border-blue-100 p-4 rounded-xl flex justify-between items-center">
            <div>
              <p className="text-blue-700 font-bold">方案 A (2小時版)</p>
              <p className="text-xs text-blue-600">領 4000 扣除勞務 2400</p>
            </div>
            <div className="text-right">
              <span className="text-xl font-black text-blue-700">+$1,600</span>
              <p className="text-[10px] text-blue-500">每次補額</p>
            </div>
          </div>
          <div className="bg-emerald-50 border border-emerald-100 p-4 rounded-xl flex justify-between items-center">
            <div>
              <p className="text-emerald-700 font-bold">方案 B (1小時版)</p>
              <p className="text-xs text-emerald-600">領 2500 扣除勞務 1200</p>
            </div>
            <div className="text-right">
              <span className="text-xl font-black text-emerald-700">+$1,300</span>
              <p className="text-[10px] text-emerald-500">每次補額</p>
            </div>
          </div>
        </div>

        {/* Table Container */}
        <div className="bg-white rounded-2xl shadow-sm overflow-hidden border border-slate-200">
          <div className="p-4 bg-slate-50 border-b border-slate-200 flex justify-between items-center">
            <h2 className="font-semibold text-slate-700">對帳清單</h2>
            <button
              onClick={addTeacher}
              className="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all"
            >
              <Plus size={16} /> 新增老師
            </button>
          </div>

          <div className="overflow-x-auto">
            <table className="w-full text-left border-collapse">
              <thead>
                <tr className="bg-slate-50/50 text-slate-400 text-[11px] uppercase tracking-wider">
                  <th className="p-4 font-bold">老師姓名</th>
                  <th className="p-4 font-bold">12月欠發時數</th>
                  <th className="p-4 font-bold bg-blue-50/30 text-blue-600">方案 A 次數</th>
                  <th className="p-4 font-bold bg-emerald-50/30 text-emerald-600">方案 B 次數</th>
                  <th className="p-4 font-bold">試算結果 (欠款 vs 補發)</th>
                  <th className="p-4 font-bold">結餘狀態</th>
                  <th className="p-4 font-bold text-center">操作</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-slate-100">
                {teachers.map((teacher) => {
                  const { debt, compensation, diff } = calculateTotal(teacher);
                  return (
                    <tr key={teacher.id} className="hover:bg-slate-50/30 transition-colors">
                      <td className="p-4">
                        <input
                          type="text"
                          value={teacher.name}
                          onChange={(e) => updateTeacher(teacher.id, 'name', e.target.value)}
                          className="bg-transparent border-b border-dashed border-slate-300 focus:border-blue-500 outline-none font-bold text-slate-700 w-full"
                        />
                      </td>
                      <td className="p-4">
                        <div className="flex items-center gap-2 bg-slate-100 rounded-lg p-1 w-fit">
                          <input
                            type="number"
                            step="0.5"
                            value={teacher.unpaidHours}
                            onChange={(e) => updateTeacher(teacher.id, 'unpaidHours', parseFloat(e.target.value) || 0)}
                            className="w-12 bg-transparent text-center font-bold outline-none"
                          />
                          <span className="text-[10px] text-slate-400 pr-2">hr</span>
                        </div>
                      </td>
                      <td className="p-4 bg-blue-50/10">
                        <div className="flex items-center gap-2">
                          <input
                            type="number"
                            value={teacher.countA}
                            onChange={(e) => updateTeacher(teacher.id, 'countA', parseInt(e.target.value) || 0)}
                            className="w-16 p-2 border border-blue-200 rounded-lg outline-none focus:ring-2 focus:ring-blue-500/20 text-center font-bold text-blue-700"
                          />
                          <span className="text-[10px] text-blue-400">次</span>
                        </div>
                      </td>
                      <td className="p-4 bg-emerald-50/10">
                        <div className="flex items-center gap-2">
                          <input
                            type="number"
                            value={teacher.countB}
                            onChange={(e) => updateTeacher(teacher.id, 'countB', parseInt(e.target.value) || 0)}
                            className="w-16 p-2 border border-emerald-200 rounded-lg outline-none focus:ring-2 focus:ring-emerald-500/20 text-center font-bold text-emerald-700"
                          />
                          <span className="text-[10px] text-emerald-400">次</span>
                        </div>
                      </td>
                      <td className="p-4">
                        <div className="flex items-center gap-3">
                          <div className="text-right">
                            <p className="text-[10px] text-slate-400">欠款</p>
                            <p className="text-xs font-bold text-slate-600">${debt.toLocaleString()}</p>
                          </div>
                          <ArrowRight size={14} className="text-slate-300" />
                          <div>
                            <p className="text-[10px] text-slate-400">補發</p>
                            <p className="text-xs font-bold text-indigo-600">${compensation.toLocaleString()}</p>
                          </div>
                        </div>
                      </td>
                      <td className="p-4">
                        {diff === 0 && teacher.unpaidHours > 0 ? (
                          <span className="text-emerald-600 text-xs font-bold flex items-center gap-1">
                            <CheckCircle2 size={14} /> 已平帳
                          </span>
                        ) : diff > 0 ? (
                          <div className="flex flex-col">
                            <span className="text-amber-600 text-xs font-bold">多補了 ${diff.toLocaleString()}</span>
                            <span className="text-[9px] text-amber-500">領據金額過多</span>
                          </div>
                        ) : diff < 0 ? (
                          <div className="flex flex-col">
                            <span className="text-red-500 text-xs font-bold">尚欠 ${Math.abs(diff).toLocaleString()}</span>
                            <span className="text-[9px] text-red-400">還需要補簽</span>
                          </div>
                        ) : (
                          <span className="text-slate-300 text-xs">尚未輸入</span>
                        )}
                      </td>
                      <td className="p-4 text-center">
                        <button
                          onClick={() => removeTeacher(teacher.id)}
                          className="text-slate-300 hover:text-red-500 transition-colors"
                        >
                          <Trash2 size={18} />
                        </button>
                      </td>
                    </tr>
                  );
                })}
              </tbody>
            </table>
          </div>
          
          {teachers.length === 0 && (
            <div className="p-12 text-center text-slate-400 italic">
              目前清單為空，請點擊「新增老師」開始計算。
            </div>
          )}
        </div>

        {/* Calculation Logic Info */}
        <div className="mt-8 bg-slate-800 rounded-2xl p-6 text-slate-300 shadow-xl">
          <h3 className="text-white font-bold mb-4 flex items-center gap-2">
            <Info size={18} /> 對帳邏輯說明
          </h3>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
            <div className="space-y-2">
              <p className="text-sm font-bold text-white border-b border-slate-700 pb-1">1. 欠款計算</p>
              <p className="text-xs">12 月欠發時數 × $1,200 (時薪)</p>
              <p className="text-xs italic text-slate-500">這是我們最終要還給老師的目標總額。</p>
            </div>
            <div className="space-y-2">
              <p className="text-sm font-bold text-white border-b border-slate-700 pb-1">2. 補發來源</p>
              <p className="text-xs">每次 A 方案補 $1,600</p>
              <p className="text-xs">每次 B 方案補 $1,300</p>
              <p className="text-xs italic text-slate-500">補發額 = (領據金額) - (當次實際勞務 × 1200)。</p>
            </div>
            <div className="space-y-2">
              <p className="text-sm font-bold text-white border-b border-slate-700 pb-1">3. 對帳目標</p>
              <p className="text-xs">試算結果越接近 <span className="text-emerald-400">已平帳</span> 越好。</p>
              <p className="text-xs text-amber-400 italic">若顯示「多補了」，代表領據報得比欠款多。</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default App;
